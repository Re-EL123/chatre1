<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Chatre LLM | Maerd</title>

  <style>
    /* ================== MAERD STYLING ================== */
    @keyframes slide {
      0% { background-position: 0% 50%; }
      50% { background-position: 100% 50%; }
      100% { background-position: 0% 50%; }
    }
    :root {
      --primary: #000;
      --background: #fff;
      --accent: linear-gradient(270deg, #FF0000, #FFA500, #FFFF00, #008000, #00FFFF, #0000FF, #8A2BE2);
      --glass: rgba(255, 255, 255, 0.1);
      --card-bg: rgba(255, 255, 255, 0.05);
      --user-msg-bg: rgba(39, 56, 82, 0.85);
      --assistant-msg-bg: rgba(20, 22, 44, 0.8);
    }
    * { box-sizing: border-box; margin: 0; padding: 0; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif; }
    body { background: var(--primary); color: var(--background); display: flex; flex-direction: column; height: 100vh; overflow: hidden; }
    .spectrum-strip {
      height: 4px;
      background: var(--accent);
      background-size: 400% 400%;
      animation: slide 5s ease infinite;
    }
    header {
      padding: 1rem;
      text-align: center;
      font-size: 1.5rem;
      font-weight: bold;
      background: var(--glass);
      backdrop-filter: blur(10px);
    }
    header p { font-size: 0.9rem; opacity: 0.8; }
    .chat-container {
      flex: 1;
      display: flex;
      flex-direction: column;
      margin: 1rem;
      border-radius: 1rem;
      overflow: hidden;
      background: var(--card-bg);
      backdrop-filter: blur(10px);
    }
    .chat-messages {
      flex: 1;
      overflow-y: auto;
      padding: 1rem;
    }
    .message {
      margin-bottom: 1rem;
      padding: 0.95rem;
      border-radius: 12px;
      max-width: 80%;
      font-size: 1rem;
      line-height: 1.5;
    }
    .user-message {
      background: var(--user-msg-bg);
      align-self: flex-end;
      margin-left: auto;
      border: 1px solid #7f5af0;
      color: #fff;
    }
    .assistant-message {
      background: var(--assistant-msg-bg);
      align-self: flex-start;
      border: 1px solid #6246ea;
      color: #ccc;
    }
    .image-message img {
      max-width: 100%;
      border-radius: 12px;
      margin-top: 0.5rem;
      box-shadow: 0 0 15px #7f5af0;
    }
    .message-input {
      display: flex;
      padding: 0.75rem;
      border-top: 1px solid rgba(255,255,255,0.1);
      background: rgba(15,23,42,0.9);
      backdrop-filter: blur(2px);
    }
    #user-input {
      flex: 1;
      padding: 0.75rem;
      border: 1px solid rgba(255,255,255,0.2);
      border-radius: 8px;
      background: rgba(23,29,43,0.8);
      color: var(--background);
      resize: none;
      min-height: 44px;
      outline: none;
    }
    #send-button {
      margin-left: 0.5rem;
      padding: 0 1rem;
      background: var(--accent);
      background-size: 400% 400%;
      animation: slide 5s ease infinite;
      color: black;
      font-weight: bold;
      border: none;
      border-radius: 8px;
      cursor: pointer;
    }
    #send-button:hover { opacity: 0.9; }
    .typing-indicator {
      display: none;
      font-style: italic;
      color: var(--background);
      opacity: 0.8;
      margin: 0.5rem;
    }
    footer {
      text-align: center;
      font-size: 0.85rem;
      padding: 0.5rem;
      background: var(--glass);
      backdrop-filter: blur(10px);
    }
    #result {
      display: block;
      margin: 1rem auto;
      max-width: 100%;
      border-radius: 12px;
      border: 2px solid var(--background);
    }
  </style>
</head>
<body>
  <div class="spectrum-strip"></div>
  <header>
    <h1>Chatre</h1>
    <p>Re-EL AI ChatBot (Maerd)</p>
  </header>

  <div class="chat-container">
    <div id="chat-messages" class="chat-messages">
      <div class="message assistant-message">
        <p>Hello! I'm Chatre, an AI chat app developed by Re-EL Technologies for Maerd. How can I help you today?</p>
      </div>
    </div>

    <div class="typing-indicator" id="typing-indicator"></div>

    <div class="message-input">
      <textarea id="user-input" placeholder="Type your message here..." rows="1" autofocus></textarea>
      <button id="send-button">Send</button>
    </div>
  </div>

  <section>
    <h3 style="text-align:center;margin-top:1rem;">Generated Image Preview</h3>
    <img id="result" alt="Generated Image Preview">
  </section>

  <footer>
    <p>Re-EL Technologies &copy; 2025</p>
  </footer>

  <script>
    function formatMarkdown(text){return text;}
    const chatMessages=document.getElementById("chat-messages");
    const userInput=document.getElementById("user-input");
    const sendButton=document.getElementById("send-button");
    const typingIndicator=document.getElementById("typing-indicator");
    const resultImg=document.getElementById("result");

    let chatHistory=[{role:"assistant",content:"Hey there! üöÄ How can I assist you today?"}];
    let isProcessing=false;

    userInput.addEventListener("keydown",function(e){
      if(e.key==="Enter"&&!e.shiftKey){e.preventDefault();sendButton.click();}
    });

    async function sendMessage(){
      const message=userInput.value.trim();
      if(message===""||isProcessing)return;
      if(/(image|draw|generate|picture|photo)/i.test(message)){
        generateImage(message);
      } else {
        chatMode(message);
      }
    }

    async function chatMode(message){
      isProcessing=true;
      addMessageToChat("user",message);
      userInput.value="";
      typingIndicator.style.display="block";

      try{
        const assistantMessageEl=document.createElement("div");
        assistantMessageEl.className="message assistant-message";
        assistantMessageEl.innerHTML="<p></p>";
        chatMessages.appendChild(assistantMessageEl);

        const response=await fetch("/api/chat",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({messages:chatHistory})});
        const result=await response.text();
        assistantMessageEl.querySelector("p").innerHTML=result;
      }catch(e){
        addMessageToChat("assistant","‚ö†Ô∏è Error fetching response.");
      }finally{
        typingIndicator.style.display="none";
        isProcessing=false;
      }
    }

    async function generateImage(prompt){
      isProcessing=true;
      addMessageToChat("user",prompt);
      userInput.value="";
      typingIndicator.style.display="block";
      try{
        const response=await fetch("/api/generate-image",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({prompt:prompt,width:512,height:512})});
        const result=await response.json();
        if(result.image_base64){
          const imgSrc="data:image/png;base64,"+result.image_base64;
          resultImg.src=imgSrc;
          const imgEl=document.createElement("div");
          imgEl.className="message assistant-message image-message";
          imgEl.innerHTML=`<p><strong>Generated Image:</strong></p><img src="${imgSrc}" alt="Generated Image">`;
          chatMessages.appendChild(imgEl);
        }else{
          addMessageToChat("assistant","‚ö†Ô∏è No image data returned.");
        }
      }catch(e){
        addMessageToChat("assistant","‚ö†Ô∏è Error generating image.");
      }finally{
        typingIndicator.style.display="none";
        isProcessing=false;
      }
    }

    function addMessageToChat(role,content){
      const messageEl=document.createElement("div");
      messageEl.className=`message ${role}-message`;
      messageEl.innerHTML=`<p>${content}</p>`;
      chatMessages.appendChild(messageEl);
      chatMessages.scrollTop=chatMessages.scrollHeight;
    }

    sendButton.addEventListener("click",sendMessage);
  </script>
</body>
</html>
